{% extends 'base.html.twig' %}

{% block title %}PokÃ©monu saraksts - PokÃ©monu meklÄ“tÄjs{% endblock %}

{% block body %}
<div class="container">
    <header class="page-header">
        <h1>PokÃ©monu meklÄ“tÄjs</h1>
        <p class="subtitle">PÄrlÅ«ko, meklÄ“ un filtrÄ“ PokÃ©monus</p>
    </header>

    <main>
        {% if error is defined and error %}
            <div class="error-message">
                <h2>âš ï¸ KÄ¼Å«da</h2>
                <p>{{ error }}</p>
            </div>
        {% else %}
            {# Search and Filter Section #}
            <section class="filters-section">
                {# Search Form #}
                <form method="get" action="{{ path('app_pokemon_list') }}" class="search-form">
                    <div class="search-input-group">
                        <input
                            type="text"
                            name="q"
                            value="{{ searchTerm }}"
                            placeholder="MeklÄ“t pÄ“c nosaukuma..."
                            class="search-input"
                            maxlength="50"
                        >
                        <button type="submit" class="search-button">MeklÄ“t</button>
                    </div>

                    {# Preserve selected types in search #}
                    {% for type in selectedTypes %}
                        <input type="hidden" name="types[]" value="{{ type }}">
                    {% endfor %}
                </form>

                {# Type Filter Form #}
                <form method="get" action="{{ path('app_pokemon_list') }}" class="filter-form">
                    <div class="filter-header">
                        <h3>FiltrÄ“t pÄ“c tipa:</h3>
                    </div>

                    <div class="type-checkboxes">
                        {% for type in allTypes %}
                            <label class="type-checkbox">
                                <input
                                    type="checkbox"
                                    name="types[]"
                                    value="{{ type }}"
                                    {% if type in selectedTypes %}checked{% endif %}
                                >
                                <span class="type-label">{{ type|type_lv }}</span>
                            </label>
                        {% endfor %}
                    </div>

                    {# Preserve search term in filter #}
                    {% if searchTerm %}
                        <input type="hidden" name="q" value="{{ searchTerm }}">
                    {% endif %}

                    <div class="filter-actions">
                        <button type="submit" class="filter-button">Lietot filtrus</button>
                        {% if selectedTypes|length > 0 or searchTerm %}
                            <a href="{{ path('app_pokemon_list') }}" class="clear-filters">NotÄ«rÄ«t visu</a>
                        {% endif %}
                    </div>
                </form>

                {# Active Filters Display #}
                {% if selectedTypes|length > 0 or searchTerm %}
                    <div class="active-filters">
                        <strong>AktÄ«vie filtri:</strong>
                        {% if searchTerm %}
                            <span class="filter-pill">MeklÄ“t: "{{ searchTerm }}"</span>
                        {% endif %}
                        {% for type in selectedTypes %}
                            <span class="filter-pill">Tips: {{ type|type_lv }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
            </section>

            {# Results Section #}
            <section class="results-section">
                {% if hasResults %}
                    {# Pokemon Grid #}
                    <div class="pokemon-grid">
                        {% for pokemon in pokemonList %}
                            {{ include('pokemon/_pokemon_card.html.twig', {pokemon: pokemon, favorites: favorites}) }}
                        {% endfor %}
                    </div>

                    {# Pagination #}
                    {% if totalPages > 1 %}
                        <nav class="pagination">
                            {# Previous Button #}
                            {% if page > 1 %}
                                <a href="{{ path('app_pokemon_list', {
                                    'q': searchTerm,
                                    'types': selectedTypes,
                                    'page': page - 1
                                }) }}" class="pagination-btn">
                                    Â« IepriekÅ¡Ä“jÄ
                                </a>
                            {% else %}
                                <span class="pagination-btn disabled">Â« IepriekÅ¡Ä“jÄ</span>
                            {% endif %}

                            {# Page Numbers #}
                            {% set startPage = max(1, page - 2) %}
                            {% set endPage = min(totalPages, page + 2) %}

                            {% if startPage > 1 %}
                                <a href="{{ path('app_pokemon_list', {
                                    'q': searchTerm,
                                    'types': selectedTypes,
                                    'page': 1
                                }) }}" class="pagination-number">1</a>

                                {% if startPage > 2 %}
                                    <span class="pagination-ellipsis">...</span>
                                {% endif %}
                            {% endif %}

                            {% for pageNum in startPage..endPage %}
                                {% if pageNum == page %}
                                    <span class="pagination-number active">{{ pageNum }}</span>
                                {% else %}
                                    <a href="{{ path('app_pokemon_list', {
                                        'q': searchTerm,
                                        'types': selectedTypes,
                                        'page': pageNum
                                    }) }}" class="pagination-number">{{ pageNum }}</a>
                                {% endif %}
                            {% endfor %}

                            {% if endPage < totalPages %}
                                {% if endPage < totalPages - 1 %}
                                    <span class="pagination-ellipsis">...</span>
                                {% endif %}

                                <a href="{{ path('app_pokemon_list', {
                                    'q': searchTerm,
                                    'types': selectedTypes,
                                    'page': totalPages
                                }) }}" class="pagination-number">{{ totalPages }}</a>
                            {% endif %}

                            {# Next Button #}
                            {% if page < totalPages %}
                                <a href="{{ path('app_pokemon_list', {
                                    'q': searchTerm,
                                    'types': selectedTypes,
                                    'page': page + 1
                                }) }}" class="pagination-btn">
                                    NÄkamÄ Â»
                                </a>
                            {% else %}
                                <span class="pagination-btn disabled">NÄkamÄ Â»</span>
                            {% endif %}
                        </nav>
                    {% endif %}

                {% else %}
                    {# Empty State #}
                    <div class="empty-state">
                        <h2>ğŸ” Nav atrasts neviens PokÃ©mon</h2>
                        <p>Nav PokÃ©monu, kas atbilst JÅ«su meklÄ“Å¡anas kritÄ“rijiem.</p>
                        {% if selectedTypes|length > 0 or searchTerm %}
                            <p>MÄ“Ä£ini:</p>
                            <ul>
                                <li>NoÅ†emt daÅ¾us tipu filtrus</li>
                                <li>Izmantot citu meklÄ“Å¡anas frÄzi</li>
                                <li>NotÄ«rÄ«t visus filtrus</li>
                            </ul>
                            <a href="{{ path('app_pokemon_list') }}" class="button-primary">NotÄ«rÄ«t visus filtrus</a>
                        {% endif %}
                    </div>
                {% endif %}
            </section>
        {% endif %}
    </main>
</div>
{% endblock %}
